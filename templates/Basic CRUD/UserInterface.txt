<?php
// --------------------------------------------------------------------
// USER INTERFACE FOR TABLE [prmTablename]
// Generated by Classmaker.php 
// Created by Adhadi Mohd
// 2011 (C) All Rights Reserved
// --------------------------------------------------------------------


require_once "config.php";
require_once "classes/cls_[prmTablename].php";
require_once "classes/core_ui.php";

?>
<html>
<title>[prmTablename] - <?php echo $_REQUEST['do']; ?></title>
<link href="css/style.css" rel="stylesheet" type="text/css">
<body>

<header>
</header>

<nav>
<?php include "nav.php"; ?>
</nav>

<section>
<?php

if (isset($_POST['submit']) && ($_POST['submit']== "Add"))
{
	processInsert();
	loadListView();

	exit();
} elseif (isset($_POST['submit']) && ($_POST['submit']== "Update"))
{
	processUpdate($_POST['id']);
	loadListView();
		exit();
}



if (isset($_REQUEST['do']))
{
	if ($_REQUEST['do']=="view")
		{
			viewForm($_REQUEST['id']);
		}
	elseif ($_REQUEST['do']=="add")
		{
			loadInsertForm();
		}
	elseif ($_REQUEST['do']=="edit")
	 {
		loadEditForm($_REQUEST['id']);
	}
		elseif ($_REQUEST['do']=="delete")
	 {
		loadDeleteForm($_REQUEST['id']);
	}
	elseif ($_REQUEST['do']=="confirmdelete")
	 {
		delete($_REQUEST['id']);
		
	}
	else {
		loadListView();
	}
}
else
{
	loadListView();
}

?>


<!--
UserInterface.Listing
-->
<?php
function loadListView()
{
	
	// sekiranya ada ditetapkan dalam session, tukarkan senarai lst
	if (isset($_SESSION['default_record_limit']))
		{$record_limit = $_SESSION['default_record_limit'];
		
		} 
		else 
		{$record_limit = 10;}
			
	if (isset($_GET['rs']))
		{$record_start = $_GET['rs'];} 
		else 
		{$record_start = 0;}
			
	if (isset($_GET['p']))
		{$current_page = $_GET['p'];} 
		else 
		{$current_page = 1;}	

	
	
	$mysqli = new mysqli( DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);
	/* check connection */
	
	if (mysqli_connect_errno()) {
	printf("Connect failed: %s\n", mysqli_connect_error());
	exit();
	}
	
	$query= "SELECT count(id) FROM [prmTablename] group by id";
	$result = $mysqli->query($query);
	$record_count= $result->num_rows; 
	
	
	$query= "SELECT * FROM [prmTablename] LIMIT $record_start, $record_limit";
	$result = $mysqli->query($query);
	
		

?>
<h1>Listing - [prmTablename]</h1>


<table id="listview" cellspacing="0" summary="Data Listing">
<caption>List of data in table [prmTablename]</caption>
<thead>
<tr>
[listParamHeader]
</tr>
</thead>
<tbody>
<?

if ($result)
	{
		while ($row = $result->fetch_assoc()) 
		{ ?>
		 <tr onClick="window.location.href='[prmTablename].php?do=view&id=<?php echo $row['id']?>';">
       		[fetchParam]
		</tr>
    	<?php 
			}
		}

    	/* free result set */
   

?>
</tbody>
</table>
<br />

<?php echo $record_count; ?> records was found
<?php
Button::Browse($record_count, $record_limit, $current_page);
Button::Create();
}
?>






<!--
UserInterface.ViewForm
-->
<?php
function viewForm($id)
{
?>
<h1>View - [prmTablename]</h1>

<table>
<tr><th>Column</th><th>Data</th></tr>
<?php

$o[prmTablename] = new c[prmTablename]();
$o[prmTablename]->load($id);
?>
[viewParam]
</table>

<div  id=menubar>
<?php
Button::Listview();
Button::Edit($id);
Button::Delete($id);
?>
</div>

<?php } ?>

<!--
UserInterface.InsertForm
-->
<?php
function loadInsertForm()
{
?>


<div id="insertform">

<h1>Add New [prmTablename] Record</h1>

<form action="[prmTablename].php?do=add" method="post" [enctype]>
[formParams]

<div id=menubar>
<?php
Button::Listview();
?>
	<input type="submit" value="Add" name="submit" class="button orange bigrounded">
</div>
</form>

</div>

<?php } ?>



<!--
UserInterface.UpdateForm
-->
<?php
function loadEditForm($id)
{
?>
<h1>Edit Record</h1>

<form action="[prmTablename].php" method="post" [enctype]>
<input type=hidden name=id value="<?php echo $id?>">
<?php

$o[prmTablename] = new c[prmTablename]();
$o[prmTablename]->load($id);

?>
<table>
<tr><th>Column</th><th>Data</th></tr>
[formUpdateParams]
</table>
<div id="menubar">
<?php
Button::Listview();
?>
	<input type="submit" value="Update" name="submit" class="button orange bigrounded">
</div>

</form>
<?php } ?>



<!--
UserInterface.DeleteForm
-->
<?php
function loadDeleteForm($id)
{
?>
<h1>View - [prmTablename]</h1>
Are you sure you want to delete this record?
<div id="menubar">
<?php
Button::ConfirmDelete($id);
?>
</div>

<table>
<tr><th>Column</th><th>Data</th></tr>
<?php

$o[prmTablename] = new c[prmTablename]();
$o[prmTablename]->load($id);
?>
[viewParam]
</table>
<?php } ?>

</section>

</body>
</html>


<?php

function processInsert()
{
	$o[prmTablename] = new c[prmTablename]();
	
	[getPostParam]

	$o[prmTablename]->insert();
}

function processUpdate($id)
{
	$o[prmTablename] = new c[prmTablename]();
	
	[getPostParam]

	$o[prmTablename]->update($id);
}

function delete($id)
{
	$o[prmTablename] = new c[prmTablename]();
	$o[prmTablename]->delete($id);
	loadListView();
}

function loadLookup($tablename)
{	

	
		$mysqli = new mysqli( DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);
		/* check connection */
		if (mysqli_connect_errno()) {
			printf("Connect failed: %s\n", mysqli_connect_error());
			exit();
		}
		
		$template = "<option value=\"[id]\">[fieldname]</option>\n";
		$str = "";
		
		$query = "select * from $tablename"; 
    	$result = $mysqli->query($query);
		
				while($row = $result->fetch_row()){ 
					$c++;
		
		
					$fieldname = $row[0];
					$t = str_replace("[fieldname]",$row[1],$template);
					$t= str_replace("[id]",$row[0],$t);
					$str .= $t;
				}

	return $str;

	
	
	
	}


?>