<?php
// --------------------------------------------------------------------
// USER INTERFACE FOR TABLE [prmTablename]
// Generated by Classmaker.php 
// Created by Adhadi Mohd
// 2011 (C) All Rights Reserved
// --------------------------------------------------------------------


require_once "config.php";
require_once "cls_[prmTablename].php";

?>
<html>
<title>[prmTablename] - <?php echo $_REQUEST['do']; ?></title>
<link href="css/style.css" rel="stylesheet" type="text/css">
<body>

<?php

if (isset($_POST['submit']) && ($_POST['submit']== "Add"))
{
	processInsert();
	loadListView();

	exit();
} elseif (isset($_POST['submit']) && ($_POST['submit']== "Update"))
{
	processUpdate($_POST['id']);
	loadListView();
		exit();
}



if (isset($_REQUEST['do']))
{
	if ($_REQUEST['do']=="view")
		{
			viewForm($_REQUEST['id']);
		}
	elseif ($_REQUEST['do']=="add")
		{
			loadInsertForm();
		}
	elseif ($_REQUEST['do']=="edit")
	 {
		loadEditForm($_REQUEST['id']);
	}
		elseif ($_REQUEST['do']=="delete")
	 {
		loadDeleteForm($_REQUEST['id']);
	}
	elseif ($_REQUEST['do']=="deleteconfirm")
	 {
		delete($_REQUEST['id']);
		
	}
	else {
		loadListView();
	}
}
else
{
	loadListView();
}

?>


<!--
UserInterface.Listing
-->
<?php
function loadListView()
{
?>
<h1>Listing - [prmTablename]</h1>


<div>
<a href="[prmTablename].php?do=add" class="button orange medium">New Record</a> 
</div>



<table id="listview" cellspacing="0" summary="Data Listing">
<caption>List of data in table [prmTablename]</caption>
<thead>
<tr>
[listParamHeader]
</tr>
</thead>
<tbody>
<?php
	
	 	$mysqli = new mysqli( DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);
		/* check connection */
	
		if (mysqli_connect_errno()) {
			printf("Connect failed: %s\n", mysqli_connect_error());
			exit();
		}
		
		$query= "SELECT * FROM [prmTablename]";
		//echo $query;
		$result = $mysqli->query($query); 
		
		 while ($row = $result->fetch_assoc()) { ?>
		 <tr onClick="window.location.href='[prmTablename].php?do=view&id=<?php echo $row['id']?>';">
       		[fetchParam]
		</tr>
    	<?php 
		}

    	/* free result set */
    	$result->free();

?>
</tbody>
</table>
<?php } ?>



<!--
UserInterface.ViewForm
-->
<?php
function viewForm($id)
{
?>
<h1>View - [prmTablename]</h1>

<table>
<tr><th>Column</th><th>Data</th></tr>
<?php

$o[prmTablename] = new c[prmTablename]();
$o[prmTablename]->load($id);
?>
[viewParam]
</table>

<div  id=menubar>
	<a href="[prmTablename].php?do=" class="button orange medium">
		Listview
	</a>

	<a href="[prmTablename].php?do=edit&id=<?php echo $id;?>" class="button orange medium">
		Edit
	</a>

	<a href="[prmTablename].php?do=delete&id=<?php echo $id;?>" class="button orange medium">
		Delete
	</a>
</div>

<?php } ?>

<!--
UserInterface.InsertForm
-->
<?php
function loadInsertForm()
{
?>
<h1>Add New Record</h1>



<form action="[prmTablename].php?do=add" method="post">
<table>
<tr><th>Column</th><th>Data</th></tr>
[formParams]
</table>

<div id=menubar>
	<a href="[prmTablename].php?do=" class="button orange medium">
		Listview
	</a>
	<input type="submit" value="Add" name="submit" class="button orange medium">
</div>

</form>
<?php } ?>


<!--
UserInterface.UpdateForm
-->
<?php
function loadEditForm($id)
{
?>
<h1>Edit Record</h1>

<form action="[prmTablename].php" method="post">
<input type=hidden name=id value="<?php echo $id?>">
<?php

$o[prmTablename] = new c[prmTablename]();
$o[prmTablename]->load($id);

?>
<table>
<tr><th>Column</th><th>Data</th></tr>
[formUpdateParams]
</table>
<div id="menubar">
	<a href="[prmTablename].php?do=" class="button orange medium">
		Listview
	</a>
	<input type="submit" value="Update" name="submit" class="button orange medium">
</div>

</form>
<?php } ?>



<!--
UserInterface.DeleteForm
-->
<?php
function loadDeleteForm($id)
{
?>
<h1>View - [prmTablename]</h1>
Are you sure you want to delete this record?
<div id="menubar">
	<a href="[prmTablename].php?do=deleteconfirm&id=<?php echo $id;?>" class="button orange medium">
		Delete
	</a>
</div>

<table>
<tr><th>Column</th><th>Data</th></tr>
<?php

$o[prmTablename] = new c[prmTablename]();
$o[prmTablename]->load($id);
?>
[viewParam]
</table>
<?php } ?>



</body>
</html>


<?php

function processInsert()
{
	$o[prmTablename] = new c[prmTablename]();
	
	[getPostParam]

	$o[prmTablename]->insert();
}

function processUpdate($id)
{
	$o[prmTablename] = new c[prmTablename]();
	
	[getPostParam]

	$o[prmTablename]->update($id);
}

function delete($id)
{
	$o[prmTablename] = new c[prmTablename]();
	$o[prmTablename]->delete($id);
	loadListView();
}

?>